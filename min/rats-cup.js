"use strict";function loadData(e){$("#buehlertann").add($("#augsburg")).add($("#walldorf")).add($("#goldbach")).add($("#badwindsheim")).add($("#weissenburg")).empty(),$("#buehlertann").load(e+"/"+e+"-buehlertann.html",function(){$("#augsburg").load(e+"/"+e+"-augsburg.html",function(){$("#walldorf").load(e+"/"+e+"-walldorf.html",function(){$("#goldbach").load(e+"/"+e+"-goldbach.html",function(){$("#badwindsheim").load(e+"/"+e+"-badwindsheim.html",function(){$("#weissenburg").load(e+"/"+e+"-weissenburg.html",function(){prepareData()})})})})})})}function prepareData(){buehlertann=[],augsburg=[],walldorf=[],goldbach=[],badwindsheim=[],weissenburg=[],$(".buehlertann").find("tr").each(function(e,t){var n=$(t).find("td:eq(2)"),a={};n[0]&&(a.name=n[0].innerText,a.pos=e,a.race="Buehlertann",buehlertann.push(a))}),$(".augsburg").find("tr").each(function(e,t){var n=$(t).find("td:eq(2)"),a={};n[0]&&(a.name=n[0].innerText,a.pos=e,a.race="Augsburg",augsburg.push(a))}),$(".walldorf").find("tr").each(function(e,t){var n=$(t).find("td:eq(2)"),a={};n[0]&&(a.name=n[0].innerText,a.pos=e,a.race="Walldorf",walldorf.push(a))}),$(".goldbach").find("tr").each(function(e,t){var n=$(t).find("td:eq(2)"),a={};n[0]&&(a.name=n[0].innerText,a.pos=e,a.race="Goldbach",goldbach.push(a))}),$(".badwindsheim").find("tr").each(function(e,t){var n=$(t).find("td:eq(2)"),a={};n[0]&&(a.name=n[0].innerText,a.pos=e,a.race="Bad Windsheim",badwindsheim.push(a))}),$(".weissenburg").find("tr").each(function(e,t){var n=$(t).find("td:eq(2)"),a={};n[0]&&(a.name=n[0].innerText,a.pos=e,a.race="Weissenburg",weissenburg.push(a))}),buehlertann.shift(),augsburg.shift(),walldorf.shift(),goldbach.shift(),badwindsheim.shift(),weissenburg.shift(),allRaces=buehlertann.concat(augsburg,walldorf,goldbach,badwindsheim,weissenburg),currentRaceCount>=4&&(currentRaceCount=4),createTable(currentRaceCount)}function createTable(e){var t=filterRaces(e).filter(function(t){return t.raceCount>=e});$.each(t,function(t,n){if(n.raceCount!==e){var a=n.raceHistory.sort(compare).slice(0,e);n.pos=0,$.each(a,function(e,t){n.pos+=t.pos})}}),t.sort(compare);var n=document.querySelector(".cup");$(n).empty(),$("<thead>\n        <td>Pos</td>\n        <td>Name</td>\n        <td>Punkte</td>\n        <td>Details</td>\n        <td>Buehlertann</td>\n        <td>Augsburg</td>\n        <td>Walldorf/Werra</td>\n        <td>Goldbach</td>\n        <td>Bad Windsheim</td>\n        <td>Weissenburg</td>\n    </thead>").appendTo($(n));var a=$("<tbody></tbody>"),s=0,d=0;$.each(t,function(t,n){var r=$('<tr class="element"></tr>'),c=$('<td class="cup-races"></td>'),o=$('<td class="cup-races"></td>'),l=$('<td class="cup-races"></td>'),i=$('<td class="cup-races"></td>'),u=$('<td class="cup-races"></td>'),p=$('<td class="cup-races"></td>'),h=$('<tr class="mobileRow"></tr>'),f=$('<tr class="mobileRow"></tr>'),b=$('<tr class="mobileRow"></tr>'),g=$('<tr class="mobileRow"></tr>'),m=$('<tr class="mobileRow"></tr>'),v=$('<tr class="mobileRow"></tr>');n.pos!==d?(s++,d=n.pos,$('<td class="cup-idx">'+s+".</td>").appendTo(r)):$('<td class="cup-idx"></td>').appendTo(r),$('<td class="cup-name">'+n.name+'</td>\n            <td class="cup-pos">'+n.pos+'</td>\n            <td class="toggleMobileRow"><div class="toggleMobileRowBtn"></div></button>\n            ').appendTo(r),$.each(n.raceHistory,function(t,n){var a=t+1<=e;"Buehlertann"===n.race&&(c=$('\n                    <td class="cup-races\n                        '+(a?"isBest":"")+'">'+n.pos+"</td>\n                "),h.append($('\n                    <td></td><td>Bühlertann</td>\n                    <td class="cup-races\n                        '+(a?"isBest":"")+'">'+n.pos+"</td><td></td>\n                "))),"Augsburg"===n.race&&(o=$('\n                    <td class="cup-races\n                        '+(a?"isBest":"")+'">'+n.pos+"</td>\n                "),f.append($('\n                    <td></td><td>Augsburg</td>\n                    <td class="cup-races\n                        '+(a?"isBest":"")+'">'+n.pos+"</td><td></td>\n                "))),"Walldorf"===n.race&&(l=$('\n                    <td class="cup-races\n                        '+(a?"isBest":"")+'">'+n.pos+"</td>\n                "),b.append($('\n                    <td></td><td>Walldorf</td>\n                    <td class="cup-races\n                        '+(a?"isBest":"")+'">'+n.pos+"</td><td></td>\n                "))),"Goldbach"===n.race&&(i=$('\n                    <td class="cup-races\n                        '+(a?"isBest":"")+'">'+n.pos+"</td>\n                "),g.append($('\n                    <td></td><td>Goldbach</td>\n                    <td class="cup-races\n                        '+(a?"isBest":"")+'">'+n.pos+"</td><td></td>\n                "))),"Bad Windsheim"===n.race&&(u=$('\n                    <td class="cup-races\n                        '+(a?"isBest":"")+'">'+n.pos+"</td>\n                "),m.append($('\n                    <td></td><td>Bad Windsheim</td>\n                    <td class="cup-races\n                        '+(a?"isBest":"")+'">'+n.pos+"</td><td></td>\n                "))),"Weissenburg"===n.race&&(p=$('\n                    <td class="cup-races\n                        '+(a?"isBest":"")+'">'+n.pos+"</td>\n                "),v.append($('\n                    <td></td><td>Weissenburg</td>\n                    <td class="cup-races\n                        '+(a?"isBest":"")+'">'+n.pos+"</td><td></td>\n                ")))}),c.appendTo(r),o.appendTo(r),l.appendTo(r),i.appendTo(r),u.appendTo(r),p.appendTo(r),r.appendTo(a),h.appendTo(a),f.appendTo(a),b.appendTo(a),g.appendTo(a),m.appendTo(a),v.appendTo(a)}),0===a.children().length?$("<div>Keine Teilnehmer vorhanden</div>").appendTo($(n)):$(n).find("thead").after(a),$(".toggleMobileRowBtn").on("click",function(e){e.preventDefault(),$(this).toggleClass("is-open"),$(this).parent().parent().toggleClass("is-open"),$(this).parent().parent().nextUntil(".element").toggleClass("is-open")})}function compare(e,t){return e.pos<t.pos?-1:e.pos>t.pos?1:0}function comparePos(e,t){return e<t?-1:e>t?1:0}function filterRaces(e){var t=[];return $(allRaces).each(function(e,n){if(!n.isCounted){var a={name:n.name,pos:n.pos,raceCount:0,raceHistory:[]};n.isCounted=!0,a.raceCount+=1,a.raceHistory.push(n),$(allRaces).each(function(e,t){t.isCounted||n.name===t.name&&(a.pos+=t.pos,a.raceCount+=1,a.raceHistory.push(t),t.isCounted=!0)}),t.push(a)}}),t}var buehlertann=[],augsburg=[],walldorf=[],goldbach=[],badwindsheim=[],weissenburg=[],allRaces=[],overallRaceCount=3,currentRaceCount=3,klasse="rats";$(document).ready(function(){$(".classSelect").val("default").prop("selected",!0),$(".filterSelect").val(currentRaceCount).prop("selected",!0);var e=document.querySelector(".cup");$(e).empty(),$(".classSelect").on("change",function(){var e=document.querySelector(".cup");$(e).empty(),$(e).append('<div class="loading">Rangliste wird erstellt...</div>');var t=this;setTimeout(function(){loadData(t.value)},300)}),$(".filterSelect").on("change",function(){if(parseInt(this.value)>overallRaceCount)alert("Auswertung noch nicht verfügbar.\n\nEs wurden erst "+overallRaceCount+" Rennen gelaufen."),$(".filterSelect").val(currentRaceCount).prop("selected",!0);else{$(allRaces).each(function(e,t){t.isCounted=!1}),currentRaceCount=parseInt(this.value);var e=document.querySelector(".cup");$(e).empty(),$(e).append('<div class="loading">Rangliste wird erstellt...</div>');var t=this;setTimeout(function(){createTable(parseInt(t.value))},300)}})});
